<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>spiraljs: demo-spiral-color</title>

        <link rel="stylesheet" type="text/css" href="https://unpkg.com/spiraljs@1.0.0-alpha.4/dist/spiral.min.css">

        <script type="text/javascript" src="https://unpkg.com/d3@^3.5.17"></script>
        <script type="text/javascript" src="https://unpkg.com/spiraljs@1.0.0-alpha.4"></script>

        <!-- load local data -->
        <script type="text/javascript" src="brwaa_2010-2015.js"></script>
        <script type="text/javascript" src="brwaa_2010-2015_inctype_categories.js"></script>
        <script type="text/javascript" src="brwaa_2010-2015_inctype_colors.js"></script>
    </head>

    <body>
        <p>
            Demo of a BubbleSpiral chart with colored bubbles. Uses d3@^3.5.17 and spiraljs@1.0.0-alpha.4.
        </p>
        <div id="spiralchart"></div>

        <script type="text/javascript">
            var bubblespiral = new spiral.BubbleSpiral(d3.select('#spiralchart'));

            var xscale = d3.time.scale();
            var time_extent = d3.extent(data, (record) => { return new Date(record.start_tijd); });
            xscale.domain(time_extent);
            xscale.range([0., 1.]);

            var one_year = 365.25*24*60*60*1000;
            var one_month = one_year / 12;
            var one_week = 7*24*60*60*1000;
            bubblespiral.period_fraction = one_week / (time_extent[1].getTime() - time_extent[0].getTime());
/*
            var map_to_color = (record) => {
                var index = primary_categories.indexOf(record.incident_type);
                var hue = (index / primary_categories.length) * 360.0;
                return d3.hsl(hue, 1.0, 0.5).rgb().toString();
            };

            var map_to_color = (record) => {
                if (record.incident_type == 'Storm en Waterschade')
                    return d3.rgb(255, 0, 0);
                return d3.rgb(0, 255, 0);
            };
*/

            var map_to_color = (record) => {
                var index = primary_categories.indexOf(record.incident_type);
                return category_colors[index];
            };

            bubblespiral.radial_map = (record) => { return xscale(new Date(record.start_tijd)); };
            bubblespiral.bubble_scale_map = (record) => { return 3.0; };
            bubblespiral.color_map = map_to_color;

            bubblespiral.render(data);
        </script>
    </body>
</html>
